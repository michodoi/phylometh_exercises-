---
title: "Assignment 6"
author: "Michelle"
date: "4/20/2020"
output:
  pdf_document: default
  html_document: default
editor_options:
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
#devtools::install_github("bomeara/geiger")
library ("ape")
library ("corHMM")
library("geiger")
library("phangorn")
library("openxlsx")
library("rotl")
library("phytools")

hollies <- get_study_tree("ot_1984", "tree1")
hollies.study.metadat<-get_study_meta("ot_1984")
hollies.tree.ids<-get_tree_ids(hollies.study.metadat)
plot(hollies, type="fan", cex = 0.4)
```
  
## You’ll need to get data into R in some way. Look at other phylometh assignments for how to #get trees and data.
```{r, eval=TRUE}
hollies <- get_study_tree("ot_1984", "tree1")
print (hollies)
hollies.study.metadat<-get_study_meta("ot_1984")
hollies.tree.ids<-get_tree_ids(hollies.study.metadat)
plot(hollies, cex = 0.4)

setwd("~/phylometh_exercises-/data\ set\ 6\ and\ 7")

hollies.data <- read.xlsx (xlsxFile = "hollies.xlsx", startRow = 2)
head(hollies.data )

#Take the first 2 names and anytime there is an "_" it will split and put it together.
GetGenusSpeciesOneTaxon <- function(x) {
  x <- gsub("_", " ", x)
  x <- strsplit(x, "\\s+")[[1]]
  return(paste0(x[1:2], collapse="_"))
}
GetGenusSpeciesManyTaxa <- function(x) {
  return(unname(sapply(x, GetGenusSpeciesOneTaxon)))
}
# To get ride of the space and replace it with an "_"
hollies.data$species <- GetGenusSpeciesManyTaxa(gsub(" ", "_", hollies.data$species))

head(hollies.data )

#To read csv files
#discrete.data <- read.csv(file= "hollies.xlsx", stringsAsFactors=FALSE)
```

#To get the color data
```{r}
hollies.colour <- hollies.data$colour
names(hollies.colour) <- hollies.data$species
print(head(hollies.colour))
print(hollies.colour)
#table(hollies.colour)
#is.na(hollies.colour)
#na.omit(hollies.colour)
#Omit NA from data set
hollies.colour <- hollies.colour[!grepl("na", hollies.colour)]
```

# Cleaning your data (Taxa and data match up)
# Now write the code to use CleanData() to actually clean your data
#CleanData <- function(phy,data) {
#return(treedata(phy, data))
#}
#Data are often not right in some way. They might not match the taxa in your tree, there may #be missing data, etc. #geiger::treedata is a great function for getting a tree and data that #match, but your data may need other cleaning. #Do it as a function so it’s repeatable.
```{r}
CleanData <- function(phy, data) {
 #result=treedata(phy, data,sort = TRUE, warnings = FALSE)
  #return(result) or the function below
  return(treedata(phy, data,sort = TRUE, warnings = FALSE))
}
hollies.cleaned<-CleanData(hollies, hollies.colour)
print(str(hollies.cleaned))
```


#VisualizeData <- function(phy, data) {
#Important here is to LOOK at your data before running it. Any weird values? Does it all make sense? What about #your #tree? Polytomies?
# Now write the code to use VisualizeData() to actually look at your data
#}

```{r, eval=TRUE}
VisualizeData <- function(phy, data) {
  dotTree(phy,data, fsize=0.5,lwd=2)
}
VisualizeData(phy=hollies.cleaned$phy,data=hollies.cleaned$data)
```

#First, let’s use parsimony to look at ancestral states:
```{r, eval=TRUE}
cleaned.discrete.phyDat <- phangorn::phyDat(hollies.cleaned$data, type="USER",levels = c("red", "brown","black"))
#phyDat is a data format used by phangorn
anc.p <- phangorn::ancestral.pars(hollies.cleaned$phy, cleaned.discrete.phyDat)
plotAnc(hollies.cleaned$phy, anc.p, 1)
```

#Now, plot the likelihood estimates.
```{r, eval=FALSE}
class(hollies.cleaned$data)
Dat<-as.phyDat(hollies.cleaned$data, type="USER", levels = c("black", "brown","red"))
anc.ml <- ancestral.pml(pml(hollies.cleaned$phy, Dat), type="ml")
plotAnc(hollies.cleaned$phy, anc.ml, 1)
print(Dat)
```


```{r}
Dat<-as.phyDat(hollies.cleaned$data, type="USER", levels = c("black", "brown","red"))
```

